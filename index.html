<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚾ 숫자 야구 게임 (모바일)</title>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /* 기본 스타일 */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            margin: 0; 
            padding: 0;
            background-color: #f0f2f5; /* 약간 어두운 배경 */
        }
        h1 { color: #1e3c72; margin-bottom: 5px; padding-top: 15px; font-size: 1.8em; }
        p { color: #666; margin-bottom: 20px; font-size: 1em; }

        /* 메인 컨테이너 */
        #game-area {
            max-width: 450px; /* 모바일 최대 너비 설정 */
            margin: 0 auto;
            padding: 20px 15px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh; /* 모바일에서 전체 화면 사용 */
        }
        
        /* 입력 및 버튼 영역 */
        #input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #guessInput {
            padding: 12px;
            font-size: 1.4em; /* 입력값 크게 */
            width: 120px; 
            margin-right: 10px;
            border: 3px solid #ddd;
            border-radius: 8px;
            text-align: center;
            box-sizing: border-box;
        }
        
        button {
            padding: 12px 18px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            height: 50px; /* 버튼 높이 조정 */
            box-sizing: border-box;
        }

        #submitBtn {
            background-color: #007bff;
            color: white;
        }
        #submitBtn:hover { background-color: #0056b3; }

        #restartBtn {
            background-color: #28a745;
            color: white;
            margin-left: 10px;
        }
        #restartBtn:hover { background-color: #1e7e34; }

        /* 결과 표시 영역 */
        #result {
            margin-top: 25px;
            padding: 15px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 8px;
            background-color: #e3f2fd; /* 밝은 파란색 배경 */
            color: #1565c0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* 기록 영역 */
        h2 { 
            font-size: 1.5em; 
            color: #444; 
            margin-top: 30px; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 5px;
        }
        #history {
            list-style: none;
            padding: 0;
            margin-top: 15px;
            max-height: 30vh; /* 모바일에서 스크롤 영역 제한 */
            overflow-y: scroll;
            text-align: left;
        }
        #history li {
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
            font-size: 1.1em;
            color: #333;
        }

        /* S/B 강조 색상 */
        .strike { color: #dc3545; font-weight: bold; } 
        .ball { color: #007bff; font-weight: bold; }   
    </style>

    <script>
        $(document).ready(function() {
            let answer = [];      
            let attempts = 0;     
            const MAX_ATTEMPTS = 10;
            const DIGIT_COUNT = 3; 

            // 게임 초기화 및 정답 생성
            function startGame() {
                answer = generateRandomNumber(DIGIT_COUNT);
                attempts = 0;
                $('#result').html(`게임 시작! **${DIGIT_COUNT}자리** 숫자를 **${MAX_ATTEMPTS}번** 안에 맞춰보세요.`);
                $('#history').empty();
                $('#guessInput').val('').prop('disabled', false).focus(); // 시작 시 입력 필드에 포커스
                $('#submitBtn').prop('disabled', false).show(); 
                $('#restartBtn').hide();
                console.log('정답 (개발자용): ' + answer.join('')); 
            }

            // 중복 없는 랜덤 숫자 배열 생성
            function generateRandomNumber(count) {
                let numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
                let result = [];
                
                for (let i = 0; i < count; i++) {
                    const index = Math.floor(Math.random() * numbers.length);
                    result.push(numbers[index]);
                    numbers.splice(index, 1);
                }
                return result;
            }

            // 사용자 입력 처리 및 게임 로직 실행
            $('#submitBtn').on('click', function() {
                const guessStr = $('#guessInput').val();
                
                // --- 입력값 유효성 검사 ---
                if (guessStr.length !== DIGIT_COUNT || !/^\d+$/.test(guessStr)) {
                    $('#result').html(`**경고:** ${DIGIT_COUNT}자리의 숫자를 정확히 입력해주세요.`);
                    return;
                }

                const guess = guessStr.split('').map(Number);
                
                // 중복 숫자 검사
                if (new Set(guess).size !== DIGIT_COUNT) {
                    $('#result').html('**경고:** 중복되지 않은 숫자를 입력해야 합니다.');
                    return;
                }
                
                attempts++;
                const { strikes, balls } = calculateScore(guess);
                updateGameStatus(guessStr, strikes, balls);

                // --- 게임 종료 조건 확인 ---
                if (strikes === DIGIT_COUNT) {
                    endGame(true); // 승리
                } else if (attempts >= MAX_ATTEMPTS) {
                    endGame(false); // 패배
                }
                
                $('#guessInput').val('').focus(); // 입력 후 다시 포커스
            });

            // 스트라이크와 볼 계산
            function calculateScore(guess) {
                let strikes = 0;
                let balls = 0;

                for (let i = 0; i < DIGIT_COUNT; i++) {
                    const guessDigit = guess[i];
                    const answerIndex = answer.indexOf(guessDigit);

                    if (answerIndex === i) {
                        strikes++; // 숫자와 위치 일치 (Strike)
                    } else if (answerIndex !== -1) {
                        balls++; // 숫자만 일치 (Ball)
                    }
                }
                return { strikes, balls };
            }

            // 게임 상태 업데이트 (결과 및 기록)
            function updateGameStatus(guessStr, strikes, balls) {
                let resultText = '';
                let historyItem = `<span style="font-weight: bold;">[${attempts}회] ${guessStr}</span> : `;
                
                if (strikes > 0 || balls > 0) {
                    if (strikes > 0) {
                        resultText += `<span class="strike">${strikes}S</span>`;
                        historyItem += `${strikes}S`;
                    }
                    if (balls > 0) {
                        if (strikes > 0) {
                            resultText += ' ';
                            historyItem += ' ';
                        }
                        resultText += `<span class="ball">${balls}B</span>`;
                        historyItem += `${balls}B`;
                    }
                } else {
                    resultText = '아웃 (Out!)';
                    historyItem += 'Out';
                }
                
                $('#result').html(`결과: ${resultText} (남은 기회: ${MAX_ATTEMPTS - attempts}회)`);
                
                // 시도 기록 추가
                $('#history').prepend(`<li>${historyItem}</li>`);
            }
            
            // 게임 종료 처리
            function endGame(isWin) {
                $('#guessInput').prop('disabled', true);
                $('#submitBtn').prop('disabled', true).hide();
                
                // 승리/패배 메시지 강조
                let finalMessage;
                if (isWin) {
                    finalMessage = `🎉 **홈런! 축하합니다!** 정답 **${answer.join('')}**! **${attempts}번** 만에 성공!`;
                    $('#result').css('background-color', '#e8f5e9').css('color', '#388e3c'); // 승리 색상
                } else {
                    finalMessage = `😭 **게임 오버!** 정답은 **${answer.join('')}**였습니다. 다시 도전하세요!`;
                    $('#result').css('background-color', '#ffebee').css('color', '#d32f2f'); // 패배 색상
                }
                $('#result').html(finalMessage);
                $('#restartBtn').show();
            }

            // 다시 시작 버튼 클릭 이벤트
            $('#restartBtn').on('click', function() {
                // 리셋 시 결과 배경색 초기화
                $('#result').css('background-color', '#e3f2fd').css('color', '#1565c0');
                startGame();
            });

            // Enter 키 (모바일 키패드의 '완료' 역할)로 제출 기능 추가
            $('#guessInput').on('keypress', function(e) {
                if (e.which === 13) { 
                    $('#submitBtn').click();
                    e.preventDefault(); 
                }
            });

            // 페이지 로드 시 게임 시작
            startGame();
        });
    </script>
</head>
<body>
    <div id="game-area">
        <h1>⚾ 숫자 야구 게임</h1>
        <p>0~9 중 중복 없는 **3자리** 숫자를 입력하세요.</p>

        <div id="input-area">
            <input 
                type="number" 
                id="guessInput" 
                maxlength="3" 
                placeholder="000" 
                inputmode="numeric" 
                pattern="\d{3}"
            >
            <button id="submitBtn">확인</button>
            <button id="restartBtn" style="display: none;">다시 시작</button>
        </div>

        <div id="result">게임 시작!</div>
        
        <h2>시도 기록</h2>
        <ul id="history"></ul>
    </div>
</body>
</html>
